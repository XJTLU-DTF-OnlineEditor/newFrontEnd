(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[30],{50877:function(G,U,t){"use strict";t.r(U),t.d(U,{default:function(){return H}});var T=t(57663),L=t(71577),_=t(62350),f=t(75443),V=t(34792),M=t(48086),C=t(3182),Z=t(69610),F=t(54941),S=t(3372),x=t(81306),$=t(72936),N=t(402),z=t(97272),Y=t(94043),a=t.n(Y),r=t(67294),n=t(73171),s=t(49101),o=t(93555),u=t(21010),e=t(11021),P=t(39265),g=t(78009),w=t(29811),h=t(85893),I=z.Z.Title,H=function(X){(0,x.Z)(R,X);var k=(0,$.Z)(R);function R(){var i;(0,Z.Z)(this,R);for(var O=arguments.length,K=new Array(O),W=0;W<O;W++)K[W]=arguments[W];return i=k.call.apply(k,[this].concat(K)),i.state={selectedRowKeys:[],dataSource:[]},i.teacher_info=r.createRef(),i.getDataSource=function(){var m=(0,C.Z)(a().mark(function l(c){var y,E,D,p;return a().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,(0,w.ar)();case 2:if(y=d.sent,i.teacher_info.current=y.data,E=i.props.location.query.topic_title,!c.title){d.next=11;break}return d.next=8,(0,u.WY)("/server/V1/course/search/?keyword=".concat(c.title),{teacher_id:i.teacher_info.current.userid});case 8:D=d.sent,d.next=14;break;case 11:return d.next=13,(0,u.WY)("/server/V1/course/courses/".concat(E,"/"));case 13:D=d.sent;case 14:if(console.log(D),D.error_code!=200){d.next=22;break}return p=D.course_list.map(function(b){var v=b.fields;return v.id=b.pk,v}),p.forEach(function(b){b.update_date=new Date(b.update_date)}),i.setState({dataSource:p}),d.abrupt("return",{data:p,success:!0,total:p.length,page:c.current});case 22:return d.abrupt("return",{success:!1,page:c.current});case 23:case"end":return d.stop()}},l)}));return function(l){return m.apply(this,arguments)}}(),i.handleDragSortEnd=function(){var m=(0,C.Z)(a().mark(function l(c){var y,E,D,p,A,d;return a().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return console.log("\u6392\u5E8F\u540E\u7684\u6570\u636E",c),y=i.props.location.query.topic_title,E=i.state.dataSource,D=E.map(function(j,B){return{id:j.id,subtopic_id:B+1}}),p=c.map(function(j,B){return{id:j.id,subtopic_id:B+1}}),A=p.filter(function(j,B){return j.id!=D[B].id}),v.next=8,(0,e.BW)(y,A);case 8:d=v.sent,d.error_code==200?(i.setState({dataSource:c}),M.default.success("Modified course order successfully")):M.default.error("Failed to modify course order! ",d.msg);case 10:case"end":return v.stop()}},l)}));return function(l){return m.apply(this,arguments)}}(),i.columns=[{title:"INDEX",dataIndex:"sort",hideInSearch:!0,width:60,render:function(l,c,y){return(0,h.jsx)("span",{className:"customRender",children:"".concat(y+1)})}},{title:"COURSE TITLE",dataIndex:"title",copyable:!0,ellipsis:!0,filters:!0,onFilter:!0},{title:"UPDATED TIME",key:"since",dataIndex:"update_date",valueType:"dateTime",hideInSearch:!0},{title:"VIEWS",dataIndex:"views",valueType:"digit",width:100,hideInSearch:!0},{title:"OPERATIONS",key:"option",valueType:"option",render:function(l,c,y,E){return[(0,h.jsx)("a",{onClick:function(){return i.props.history.push("/courseAdmin/courseDisplay?topic_title="+i.props.location.query.topic_title+"&id="+c.id)},children:"view"},"1"),(0,h.jsx)("a",{onClick:function(){return i.props.history.push("/courseAdmin/courseManager?topic_title="+i.props.location.query.topic_title+"&id="+c.id)},children:"edit"},"2"),(0,h.jsx)(f.Z,{title:"Are you sure to delete the course?",onConfirm:(0,C.Z)(a().mark(function D(){var p,A,d;return a().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return p=(0,S.Z)(i),A=p.table,v.next=3,(0,e.A)(i.props.location.query.topic_title,[c.id]);case 3:d=v.sent,d.error_code==200?M.default.success("Delete success"):M.default.error("Delete error"),A.reload();case 6:case"end":return v.stop()}},D)})),okText:"Yes",cancelText:"No",children:(0,h.jsx)("a",{children:"delete"},"3")})]}}],i.handleDelete=(0,C.Z)(a().mark(function m(){var l,c,y,E;return a().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return l=(0,S.Z)(i),c=l.table,y=i.state.selectedRowKeys,p.next=4,(0,e.A)(i.props.location.query.topic_title,y);case 4:E=p.sent,E.error_code==200?M.default.success("Delete success"):M.default.error("Delete error"),c.reload();case 7:case"end":return p.stop()}},m)})),i}return(0,F.Z)(R,[{key:"render",value:function(){var O=this,K=this.props.location.query.topic_title,W=function(l){O.setState({selectedRowKeys:l})};return(0,h.jsx)(g.ZP,{ghost:!0,onBack:function(){return O.props.history.push("/courseAdmin")},header:{title:(0,h.jsx)(I,{level:2,children:K})},children:(0,h.jsx)(P.ZP,{children:(0,h.jsx)(o.Z,{actionRef:function(l){return O.table=l},columns:this.columns,request:(0,C.Z)(a().mark(function m(){var l,c=arguments;return a().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return l=c.length>0&&c[0]!==void 0?c[0]:{},E.abrupt("return",O.getDataSource(l));case 2:case"end":return E.stop()}},m)})),rowSelection:{selectedRowKeys:this.state.selectedRowKeys,onChange:W},editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"id",search:{labelWidth:"auto"},form:{syncToUrl:function(l,c){return c==="get"?Object.assign(Object.assign({},l),{created_at:[l.startTime,l.endTime]}):l}},pagination:{pageSize:10},dateFormatter:"string",headerTitle:"course list",toolBarRender:function(){return[(0,h.jsx)(f.Z,{title:"Are you sure to delete the chosen courses?",onConfirm:O.handleDelete,okText:"Yes",cancelText:"No",children:(0,h.jsx)(L.Z,{icon:(0,h.jsx)(n.Z,{}),type:"primary",danger:!0,disabled:O.state.selectedRowKeys.length==0,children:"Delete"},"button")}),(0,h.jsx)(L.Z,{icon:(0,h.jsx)(s.Z,{}),type:"primary",children:(0,h.jsx)("a",{href:"/courseAdmin/courseManager?topic_title="+K,rel:"noopener noreferrer",style:{color:"inherit"},children:"New"},"view")},"button")]},dragSortKey:"sort",dataSource:this.state.dataSource,onDragSortEnd:this.handleDragSortEnd})})})}}]),R}(r.Component)},11021:function(G,U,t){"use strict";t.d(U,{D0:function(){return V},wA:function(){return M},tu:function(){return C},rq:function(){return Z},xH:function(){return F},G$:function(){return S},Sp:function(){return x},A:function(){return $},BK:function(){return N},BW:function(){return z},EI:function(){return Y}});var T=t(3182),L=t(94043),_=t.n(L),f=t(21010),V=function(){var a=(0,T.Z)(_().mark(function r(n){var s;return _().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s="/server/V1/course/topicsByTeacher/?teacher_id=".concat(n),u.abrupt("return",(0,f.WY)(s));case 2:case"end":return u.stop()}},r)}));return function(n){return a.apply(this,arguments)}}(),M=function(){var a=(0,T.Z)(_().mark(function r(n,s){var o;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="/server/V1/course/edit/",e.abrupt("return",(0,f.WY)(o,{method:"post",data:{request_entity:"Topic",content:{topic_id:n,topic_info:s}}}));case 2:case"end":return e.stop()}},r)}));return function(n,s){return a.apply(this,arguments)}}(),C=function(){var a=(0,T.Z)(_().mark(function r(n,s,o,u,e,P,g){var w;return _().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return w="/server/V1/course/edit/",I.abrupt("return",(0,f.WY)(w,{method:"post",data:{request_entity:"Course",content:{id:n,related_topic:s,title:o,content:u,answer:e,hint:P,teacher_id:g}}}));case 2:case"end":return I.stop()}},r)}));return function(n,s,o,u,e,P,g){return a.apply(this,arguments)}}(),Z=function(){var a=(0,T.Z)(_().mark(function r(n,s,o,u){var e;return _().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return e="/server/V1/course/create/",g.abrupt("return",(0,f.WY)(e,{method:"post",data:{request_entity:"Topic",content:{topic_title:n,topic_content:s,topic_img:o,teacher_id:u}}}));case 2:case"end":return g.stop()}},r)}));return function(n,s,o,u){return a.apply(this,arguments)}}(),F=function(){var a=(0,T.Z)(_().mark(function r(n,s,o,u,e){var P;return _().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return P="/server/V1/course/create/",w.abrupt("return",(0,f.WY)(P,{method:"post",data:{request_entity:"Course",content:{related_topic:n,title:s,content:o,answer:u,hint:e}}}));case 2:case"end":return w.stop()}},r)}));return function(n,s,o,u,e){return a.apply(this,arguments)}}(),S=function(){var a=(0,T.Z)(_().mark(function r(n){var s;return _().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s="/server/V1/course/courses/".concat(n,"/"),u.abrupt("return",(0,f.WY)(s));case 2:case"end":return u.stop()}},r)}));return function(n){return a.apply(this,arguments)}}(),x=function(){var a=(0,T.Z)(_().mark(function r(n,s){var o;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="/server/V1/course/courseDetail/".concat(n,"/").concat(s,"/"),e.abrupt("return",(0,f.WY)(o));case 2:case"end":return e.stop()}},r)}));return function(n,s){return a.apply(this,arguments)}}(),$=function(){var a=(0,T.Z)(_().mark(function r(n,s){var o;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="/server/V1/course/delete/",e.abrupt("return",(0,f.WY)(o,{method:"post",data:{request_entity:"Course",related_topic:n,content:s}}));case 2:case"end":return e.stop()}},r)}));return function(n,s){return a.apply(this,arguments)}}(),N=function(){var a=(0,T.Z)(_().mark(function r(n){var s;return _().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s="/server/V1/course/delete/",u.abrupt("return",(0,f.WY)(s,{method:"post",data:{request_entity:"Topic",content:n}}));case 2:case"end":return u.stop()}},r)}));return function(n){return a.apply(this,arguments)}}(),z=function(){var a=(0,T.Z)(_().mark(function r(n,s){var o;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="/server/V1/course/sort/",e.abrupt("return",(0,f.WY)(o,{method:"post",data:{request_entity:"Course",related_topic:n,content:s}}));case 2:case"end":return e.stop()}},r)}));return function(n,s){return a.apply(this,arguments)}}(),Y=function(){var a=(0,T.Z)(_().mark(function r(n,s){var o;return _().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="/server/V1/course/delete_img/",e.abrupt("return",(0,f.WY)(o,{method:"post",data:{request_entity:s,fname:n}}));case 2:case"end":return e.stop()}},r)}));return function(n,s){return a.apply(this,arguments)}}()}}]);
