(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[30],{50877:function(V,K,e){"use strict";e.r(K),e.d(K,{default:function(){return b}});var g=e(57663),B=e(71577),l=e(62350),f=e(75443),z=e(34792),P=e(48086),M=e(3182),U=e(69610),Z=e(54941),S=e(3372),F=e(81306),x=e(72936),$=e(94043),v=e.n($),d=e(67294),r=e(73171),t=e(49101),n=e(97799),o=e(21010),s=e(11021),a=e(39265),C=e(78009),u=e(85893),b=function(k){(0,F.Z)(W,k);var Y=(0,x.Z)(W);function W(){var i;(0,U.Z)(this,W);for(var O=arguments.length,A=new Array(O),I=0;I<O;I++)A[I]=arguments[I];return i=Y.call.apply(Y,[this].concat(A)),i.state={selectedRowKeys:[],dataSource:[]},i.getDataSource=function(){var m=(0,M.Z)(v().mark(function _(c){var D,h,E;return v().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(D=i.props.location.query.topic_title,!c.title){p.next=7;break}return p.next=4,(0,o.WY)("/server/V1/course/search/?keyword=".concat(c.title),{teacher_id:i.props.location.query.teacher_id});case 4:h=p.sent,p.next=10;break;case 7:return p.next=9,(0,o.WY)("/server/V1/course/courses/".concat(D,"/"));case 9:h=p.sent;case 10:if(h.error_code!=200){p.next=17;break}return E=h.course_list.map(function(y){var L=y.fields;return L.id=y.pk,L}),E.forEach(function(y){y.update_date=new Date(y.update_date)}),i.setState({dataSource:E}),p.abrupt("return",{data:E,success:!0,total:E.length,page:c.current});case 17:return p.abrupt("return",{success:!1,page:c.current});case 18:case"end":return p.stop()}},_)}));return function(_){return m.apply(this,arguments)}}(),i.handleDragSortEnd=function(){var m=(0,M.Z)(v().mark(function _(c){var D,h,E,T,p,y;return v().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return console.log("\u6392\u5E8F\u540E\u7684\u6570\u636E",c),D=i.props.location.query.topic_title,h=i.state.dataSource,E=h.map(function(R,j){return{id:R.id,subtopic_id:j+1}}),T=c.map(function(R,j){return{id:R.id,subtopic_id:j+1}}),p=T.filter(function(R,j){return R.id!=E[j].id}),w.next=8,(0,s.BW)(D,p);case 8:y=w.sent,y.error_code==200?(i.setState({dataSource:c}),P.default.success("Modified course order successfully")):P.default.error("Failed to modify course order! ",y.msg);case 10:case"end":return w.stop()}},_)}));return function(_){return m.apply(this,arguments)}}(),i.columns=[{title:"INDEX",dataIndex:"sort",hideInSearch:!0,width:60,render:function(_,c,D){return(0,u.jsx)("span",{className:"customRender",children:"".concat(D+1)})}},{title:"COURSE TITLE",dataIndex:"title",copyable:!0,ellipsis:!0,filters:!0,onFilter:!0},{title:"UPDATED TIME",key:"since",dataIndex:"update_date",valueType:"dateTime",hideInSearch:!0},{title:"VIEWS",dataIndex:"views",valueType:"digit",width:100,hideInSearch:!0},{title:"OPERATIONS",key:"option",valueType:"option",render:function(_,c,D,h){return[(0,u.jsx)("a",{onClick:function(){return i.props.history.push("/courseAdmin/courseDisplay?topic_title="+i.props.location.query.topic_title+"&id="+c.id)},children:"view"},"1"),(0,u.jsx)("a",{onClick:function(){return i.props.history.push("/courseAdmin/courseManager?topic_title="+i.props.location.query.topic_title+"&id="+c.id)},children:"edit"},"2"),(0,u.jsx)(f.Z,{title:"Are you sure to delete the course?",onConfirm:(0,M.Z)(v().mark(function E(){var T,p,y;return v().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return T=(0,S.Z)(i),p=T.table,w.next=3,(0,s.A)(i.props.location.query.topic_title,[c.id]);case 3:y=w.sent,y.error_code==200?P.default.success("Delete success"):P.default.error("Delete error"),p.reload();case 6:case"end":return w.stop()}},E)})),okText:"Yes",cancelText:"No",children:(0,u.jsx)("a",{children:"delete"},"3")})]}}],i.handleDelete=(0,M.Z)(v().mark(function m(){var _,c,D,h;return v().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return _=(0,S.Z)(i),c=_.table,D=i.state.selectedRowKeys,T.next=4,(0,s.A)(i.props.location.query.topic_title,D);case 4:h=T.sent,h.error_code==200?P.default.success("Delete success"):P.default.error("Delete error"),c.reload();case 7:case"end":return T.stop()}},m)})),i}return(0,Z.Z)(W,[{key:"render",value:function(){var O=this,A=this.props.location.query.topic_title,I=function(_){O.setState({selectedRowKeys:_})};return(0,u.jsx)(C.ZP,{ghost:!0,onBack:function(){return O.props.history.push("/courseAdmin")},header:{title:"Course List"},children:(0,u.jsx)(a.ZP,{children:(0,u.jsx)(n.Z,{actionRef:function(_){return O.table=_},columns:this.columns,request:(0,M.Z)(v().mark(function m(){var _,c=arguments;return v().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return _=c.length>0&&c[0]!==void 0?c[0]:{},h.abrupt("return",O.getDataSource(_));case 2:case"end":return h.stop()}},m)})),rowSelection:{selectedRowKeys:this.state.selectedRowKeys,onChange:I},editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"id",search:{labelWidth:"auto"},form:{syncToUrl:function(_,c){return c==="get"?Object.assign(Object.assign({},_),{created_at:[_.startTime,_.endTime]}):_}},pagination:{pageSize:10},dateFormatter:"string",headerTitle:"\u3010TOPIC TITLE\u3011"+A,toolBarRender:function(){return[(0,u.jsx)(f.Z,{title:"Are you sure to delete the chosen courses?",onConfirm:O.handleDelete,okText:"Yes",cancelText:"No",children:(0,u.jsx)(B.Z,{icon:(0,u.jsx)(r.Z,{}),type:"primary",danger:!0,disabled:O.state.selectedRowKeys.length==0,children:"Delete"},"button")}),(0,u.jsx)(B.Z,{icon:(0,u.jsx)(t.Z,{}),type:"primary",children:(0,u.jsx)("a",{href:"/courseAdmin/courseManager?topic_title="+A,rel:"noopener noreferrer",style:{color:"inherit"},children:"New"},"view")},"button")]},dragSortKey:"sort",dataSource:this.state.dataSource,onDragSortEnd:this.handleDragSortEnd})})})}}]),W}(d.Component)},11021:function(V,K,e){"use strict";e.d(K,{D0:function(){return z},wA:function(){return P},tu:function(){return M},rq:function(){return U},xH:function(){return Z},G$:function(){return S},Sp:function(){return F},A:function(){return x},BK:function(){return $},BW:function(){return v}});var g=e(3182),B=e(94043),l=e.n(B),f=e(21010),z=function(){var d=(0,g.Z)(l().mark(function r(t){var n;return l().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n="/server/V1/course/topicsByTeacher/?teacher_id=".concat(t),s.abrupt("return",(0,f.WY)(n));case 2:case"end":return s.stop()}},r)}));return function(t){return d.apply(this,arguments)}}(),P=function(){var d=(0,g.Z)(l().mark(function r(t,n){var o;return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o="/server/V1/course/edit/",a.abrupt("return",(0,f.WY)(o,{method:"post",data:{request_entity:"Topic",content:{topic_id:t,topic_info:n}}}));case 2:case"end":return a.stop()}},r)}));return function(t,n){return d.apply(this,arguments)}}(),M=function(){var d=(0,g.Z)(l().mark(function r(t,n,o,s,a){var C;return l().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return C="/server/V1/course/edit/",b.abrupt("return",(0,f.WY)(C,{method:"post",data:{request_entity:"Course",content:{id:t,related_topic:n,title:o,content:s,teacher_id:a}}}));case 2:case"end":return b.stop()}},r)}));return function(t,n,o,s,a){return d.apply(this,arguments)}}(),U=function(){var d=(0,g.Z)(l().mark(function r(t,n,o,s){var a;return l().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return a="/server/V1/course/create/",u.abrupt("return",(0,f.WY)(a,{method:"post",data:{request_entity:"Topic",content:{topic_title:t,topic_content:n,topic_img:o,teacher_id:s}}}));case 2:case"end":return u.stop()}},r)}));return function(t,n,o,s){return d.apply(this,arguments)}}(),Z=function(){var d=(0,g.Z)(l().mark(function r(t,n,o,s){var a;return l().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return a="/server/V1/course/create/",u.abrupt("return",(0,f.WY)(a,{method:"post",data:{request_entity:"Course",content:{related_topic:t,title:n,content:o,teacher_id:s}}}));case 2:case"end":return u.stop()}},r)}));return function(t,n,o,s){return d.apply(this,arguments)}}(),S=function(){var d=(0,g.Z)(l().mark(function r(t){var n;return l().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n="/server/V1/course/courses/".concat(t,"/"),s.abrupt("return",(0,f.WY)(n));case 2:case"end":return s.stop()}},r)}));return function(t){return d.apply(this,arguments)}}(),F=function(){var d=(0,g.Z)(l().mark(function r(t,n){var o;return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o="/server/V1/course/courseDetail/".concat(t,"/").concat(n,"/"),a.abrupt("return",(0,f.WY)(o));case 2:case"end":return a.stop()}},r)}));return function(t,n){return d.apply(this,arguments)}}(),x=function(){var d=(0,g.Z)(l().mark(function r(t,n){var o;return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o="/server/V1/course/delete/",a.abrupt("return",(0,f.WY)(o,{method:"post",data:{request_entity:"Course",related_topic:t,content:n}}));case 2:case"end":return a.stop()}},r)}));return function(t,n){return d.apply(this,arguments)}}(),$=function(){var d=(0,g.Z)(l().mark(function r(t){var n;return l().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n="/server/V1/course/delete/",s.abrupt("return",(0,f.WY)(n,{method:"post",data:{request_entity:"Topic",content:t}}));case 2:case"end":return s.stop()}},r)}));return function(t){return d.apply(this,arguments)}}(),v=function(){var d=(0,g.Z)(l().mark(function r(t,n){var o;return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o="/server/V1/course/sort/",a.abrupt("return",(0,f.WY)(o,{method:"post",data:{request_entity:"Course",related_topic:t,content:n}}));case 2:case"end":return a.stop()}},r)}));return function(t,n){return d.apply(this,arguments)}}()}}]);
