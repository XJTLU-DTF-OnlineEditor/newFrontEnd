(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[30],{50877:function(N,j,s){"use strict";s.r(j),s.d(j,{default:function(){return G}});var v=s(57663),K=s(71577),i=s(62350),m=s(75443),z=s(34792),M=s(48086),P=s(3182),U=s(69610),L=s(54941),B=s(3372),Z=s(81306),F=s(72936),Y=s(402),x=s(97272),$=s(94043),a=s.n($),r=s(67294),t=s(73171),n=s(49101),o=s(97799),u=s(21010),e=s(11021),C=s(57895),D=s(78009),d=s(85893),k=x.Z.Title,G=function(H){(0,Z.Z)(I,H);var V=(0,F.Z)(I);function I(){var _;(0,U.Z)(this,I);for(var O=arguments.length,W=new Array(O),b=0;b<O;b++)W[b]=arguments[b];return _=V.call.apply(V,[this].concat(W)),_.state={selectedRowKeys:[],dataSource:[]},_.getDataSource=function(){var f=(0,P.Z)(a().mark(function l(c){var T,h,E;return a().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(T=_.props.location.query.topic_title,!c.title){p.next=7;break}return p.next=4,(0,u.WY)("/server/V1/course/search/?keyword=".concat(c.title),{teacher_id:_.props.location.query.teacher_id});case 4:h=p.sent,p.next=10;break;case 7:return p.next=9,(0,u.WY)("/server/V1/course/courses/".concat(T,"/"));case 9:h=p.sent;case 10:if(h.error_code!=200){p.next=17;break}return E=h.course_list.map(function(g){var S=g.fields;return S.id=g.pk,S}),E.forEach(function(g){g.update_date=new Date(g.update_date)}),_.setState({dataSource:E}),p.abrupt("return",{data:E,success:!0,total:E.length,page:c.current});case 17:return p.abrupt("return",{success:!1,page:c.current});case 18:case"end":return p.stop()}},l)}));return function(l){return f.apply(this,arguments)}}(),_.handleDragSortEnd=function(){var f=(0,P.Z)(a().mark(function l(c){var T,h,E,y,p,g;return a().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return console.log("\u6392\u5E8F\u540E\u7684\u6570\u636E",c),T=_.props.location.query.topic_title,h=_.state.dataSource,E=h.map(function(A,R){return{id:A.id,subtopic_id:R+1}}),y=c.map(function(A,R){return{id:A.id,subtopic_id:R+1}}),p=y.filter(function(A,R){return A.id!=E[R].id}),w.next=8,(0,e.BW)(T,p);case 8:g=w.sent,g.error_code==200?(_.setState({dataSource:c}),M.default.success("Modified course order successfully")):M.default.error("Failed to modify course order! ",g.msg);case 10:case"end":return w.stop()}},l)}));return function(l){return f.apply(this,arguments)}}(),_.columns=[{title:"INDEX",dataIndex:"sort",hideInSearch:!0,width:60,render:function(l,c,T){return(0,d.jsx)("span",{className:"customRender",children:"".concat(T+1)})}},{title:"COURSE TITLE",dataIndex:"title",copyable:!0,ellipsis:!0,filters:!0,onFilter:!0},{title:"UPDATED TIME",key:"since",dataIndex:"update_date",valueType:"dateTime",hideInSearch:!0},{title:"VIEWS",dataIndex:"views",valueType:"digit",width:100,hideInSearch:!0},{title:"OPERATIONS",key:"option",valueType:"option",render:function(l,c,T,h){return[(0,d.jsx)("a",{onClick:function(){return _.props.history.push("/courseAdmin/courseDisplay?topic_title="+_.props.location.query.topic_title+"&id="+c.id)},children:"view"},"1"),(0,d.jsx)("a",{onClick:function(){return _.props.history.push("/courseAdmin/courseManager?topic_title="+_.props.location.query.topic_title+"&id="+c.id)},children:"edit"},"2"),(0,d.jsx)(m.Z,{title:"Are you sure to delete the course?",onConfirm:(0,P.Z)(a().mark(function E(){var y,p,g;return a().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return y=(0,B.Z)(_),p=y.table,w.next=3,(0,e.A)(_.props.location.query.topic_title,[c.id]);case 3:g=w.sent,g.error_code==200?M.default.success("Delete success"):M.default.error("Delete error"),p.reload();case 6:case"end":return w.stop()}},E)})),okText:"Yes",cancelText:"No",children:(0,d.jsx)("a",{children:"delete"},"3")})]}}],_.handleDelete=(0,P.Z)(a().mark(function f(){var l,c,T,h;return a().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return l=(0,B.Z)(_),c=l.table,T=_.state.selectedRowKeys,y.next=4,(0,e.A)(_.props.location.query.topic_title,T);case 4:h=y.sent,h.error_code==200?M.default.success("Delete success"):M.default.error("Delete error"),c.reload();case 7:case"end":return y.stop()}},f)})),_}return(0,L.Z)(I,[{key:"render",value:function(){var O=this,W=this.props.location.query.topic_title,b=function(l){O.setState({selectedRowKeys:l})};return(0,d.jsx)(D.ZP,{ghost:!0,onBack:function(){return O.props.history.push("/courseAdmin")},header:{title:(0,d.jsx)(k,{level:2,children:W})},children:(0,d.jsx)(C.ZP,{children:(0,d.jsx)(o.Z,{actionRef:function(l){return O.table=l},columns:this.columns,request:(0,P.Z)(a().mark(function f(){var l,c=arguments;return a().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return l=c.length>0&&c[0]!==void 0?c[0]:{},h.abrupt("return",O.getDataSource(l));case 2:case"end":return h.stop()}},f)})),rowSelection:{selectedRowKeys:this.state.selectedRowKeys,onChange:b},editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"id",search:{labelWidth:"auto"},form:{syncToUrl:function(l,c){return c==="get"?Object.assign(Object.assign({},l),{created_at:[l.startTime,l.endTime]}):l}},pagination:{pageSize:10},dateFormatter:"string",headerTitle:"course list",toolBarRender:function(){return[(0,d.jsx)(m.Z,{title:"Are you sure to delete the chosen courses?",onConfirm:O.handleDelete,okText:"Yes",cancelText:"No",children:(0,d.jsx)(K.Z,{icon:(0,d.jsx)(t.Z,{}),type:"primary",danger:!0,disabled:O.state.selectedRowKeys.length==0,children:"Delete"},"button")}),(0,d.jsx)(K.Z,{icon:(0,d.jsx)(n.Z,{}),type:"primary",children:(0,d.jsx)("a",{href:"/courseAdmin/courseManager?topic_title="+W,rel:"noopener noreferrer",style:{color:"inherit"},children:"New"},"view")},"button")]},dragSortKey:"sort",dataSource:this.state.dataSource,onDragSortEnd:this.handleDragSortEnd})})})}}]),I}(r.Component)},11021:function(N,j,s){"use strict";s.d(j,{D0:function(){return z},wA:function(){return M},tu:function(){return P},rq:function(){return U},xH:function(){return L},G$:function(){return B},Sp:function(){return Z},A:function(){return F},BK:function(){return Y},BW:function(){return x},EI:function(){return $}});var v=s(3182),K=s(94043),i=s.n(K),m=s(21010),z=function(){var a=(0,v.Z)(i().mark(function r(t){var n;return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return n="/server/V1/course/topicsByTeacher/?teacher_id=".concat(t),u.abrupt("return",(0,m.WY)(n));case 2:case"end":return u.stop()}},r)}));return function(t){return a.apply(this,arguments)}}(),M=function(){var a=(0,v.Z)(i().mark(function r(t,n){var o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="/server/V1/course/edit/",e.abrupt("return",(0,m.WY)(o,{method:"post",data:{request_entity:"Topic",content:{topic_id:t,topic_info:n}}}));case 2:case"end":return e.stop()}},r)}));return function(t,n){return a.apply(this,arguments)}}(),P=function(){var a=(0,v.Z)(i().mark(function r(t,n,o,u,e){var C;return i().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return C="/server/V1/course/edit/",d.abrupt("return",(0,m.WY)(C,{method:"post",data:{request_entity:"Course",content:{id:t,related_topic:n,title:o,content:u,teacher_id:e}}}));case 2:case"end":return d.stop()}},r)}));return function(t,n,o,u,e){return a.apply(this,arguments)}}(),U=function(){var a=(0,v.Z)(i().mark(function r(t,n,o,u){var e;return i().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return e="/server/V1/course/create/",D.abrupt("return",(0,m.WY)(e,{method:"post",data:{request_entity:"Topic",content:{topic_title:t,topic_content:n,topic_img:o,teacher_id:u}}}));case 2:case"end":return D.stop()}},r)}));return function(t,n,o,u){return a.apply(this,arguments)}}(),L=function(){var a=(0,v.Z)(i().mark(function r(t,n,o,u){var e;return i().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return e="/server/V1/course/create/",D.abrupt("return",(0,m.WY)(e,{method:"post",data:{request_entity:"Course",content:{related_topic:t,title:n,content:o,teacher_id:u}}}));case 2:case"end":return D.stop()}},r)}));return function(t,n,o,u){return a.apply(this,arguments)}}(),B=function(){var a=(0,v.Z)(i().mark(function r(t){var n;return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return n="/server/V1/course/courses/".concat(t,"/"),u.abrupt("return",(0,m.WY)(n));case 2:case"end":return u.stop()}},r)}));return function(t){return a.apply(this,arguments)}}(),Z=function(){var a=(0,v.Z)(i().mark(function r(t,n){var o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="/server/V1/course/courseDetail/".concat(t,"/").concat(n,"/"),e.abrupt("return",(0,m.WY)(o));case 2:case"end":return e.stop()}},r)}));return function(t,n){return a.apply(this,arguments)}}(),F=function(){var a=(0,v.Z)(i().mark(function r(t,n){var o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="/server/V1/course/delete/",e.abrupt("return",(0,m.WY)(o,{method:"post",data:{request_entity:"Course",related_topic:t,content:n}}));case 2:case"end":return e.stop()}},r)}));return function(t,n){return a.apply(this,arguments)}}(),Y=function(){var a=(0,v.Z)(i().mark(function r(t){var n;return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return n="/server/V1/course/delete/",u.abrupt("return",(0,m.WY)(n,{method:"post",data:{request_entity:"Topic",content:t}}));case 2:case"end":return u.stop()}},r)}));return function(t){return a.apply(this,arguments)}}(),x=function(){var a=(0,v.Z)(i().mark(function r(t,n){var o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="/server/V1/course/sort/",e.abrupt("return",(0,m.WY)(o,{method:"post",data:{request_entity:"Course",related_topic:t,content:n}}));case 2:case"end":return e.stop()}},r)}));return function(t,n){return a.apply(this,arguments)}}(),$=function(){var a=(0,v.Z)(i().mark(function r(t,n){var o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="/server/V1/course/delete_img/",e.abrupt("return",(0,m.WY)(o,{method:"post",data:{request_entity:n,fname:t}}));case 2:case"end":return e.stop()}},r)}));return function(t,n){return a.apply(this,arguments)}}()}}]);
